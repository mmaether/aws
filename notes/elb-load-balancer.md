# Load Balancers

## Application Load Balancer (v2)

* Stickiness can be enabled at the target group level.
  * Same request goes to the same instance.
  * Stickiness is directly generated by the ALB (not the application).
* ALB support HTTP/HTTPS and websockets protocols.
* The application servers don't see the IP of the client directly.
  * The true IP of the client is inserted in the header **X-Forwarded-For**.

## Network Load Balancer (v2)

* Network load balancers (layer 4) allows you to:
  * Forward TCP traffic to your instances.
  * Handle millions of request per seconds
  * Support for static or elastic IP
  * Less latence ~100ms (vs 400ms for ALB).
* Mostly used for extreme performance and should not be the default load balancer to choose.
* Same creation process as Application Load Balancer.

Good to know:

* Classic load balancers are deprecated.
* Use Application Load Balancer for HTTP / HTTPs & websockets.
* Network Load Balancer for TCP.
* CLB and ALB support SSL certificates and provide SSL termination.
* All load balancers have health check capability.
* ALB can route based on hostname / path
* ALB is a great fit with ECS (Docker)
* Any load balancer has a static host name. Do not resolve and use underlying IP.
* Load balancers can scale but not instantly. Contact AWS for a "warm-up."
* NLB directly to see the client IP.
* 4xx errors are client induced errors.
* 5xx errors are application induced errors.
  * Error 503 means at capacity or no registered target.
* If the LB can't connect to your application, check your security groups!

## Auto Scaling Group

The goal of an Auto Scaling Group (ASG) is to:

* Scale out (add EC2 instances) to match an increased load.
* Scale in (remove EC2 instances) to match a decreased load.
* Ensure we have a minimum and maximum number of machines running.
* Automatically register new instances to a load balancer.